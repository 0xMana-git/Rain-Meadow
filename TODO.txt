Rain Meadow

on join, takes a while to get lobby data, grey out button
	done

Manage missing regions:
	right now nullrefs because missing referenced resource
	only joinable on same world-checksum? world-list? world-index-checksum?
	in my head the problem is that if by transfer someone who is missing things becomes the owner then some resources will be unmanageable?
		could in this case we just create room-less RoomSessions for the stuff that is requested but doesn't exist? Only someone who has it will request it, one doesn't have to have it to lease it
			catch: world creatures would be in an invalid position

Entities entities entities
	need new hookpoint for objects being moved between worlds, so they're added to the new world 
		but maybe just the removal-addal works?
		need at least to clear out untransferable self from old world so it can deactivate
		todo check how current code behaves, I havent event tested it much
			done and done

	Entity Join/leave should be handshaked, owner can change inbetween
		the "ent-owner-to-room-owner"

	handle entities entering shortcuts
	entering/leaving shorcuts should be a room-level event with the coordinate of the damned thing
		could do suckedintoshortcuts and spitoutofshortcut as events and bypass the whole vanilla thing

	handle entities entering dens
		could also be event-based
		would maybe also have to handle the whole switchcase at "the end of the shortcut" when the creature then either enters a den or leaves the room or whatever
	
	handle grasps
		grasps need to be sent around in a similar way entities are
		the biggest problem is: can only send grasps once we've identified all entities involved
		on entity-join, if all connected entities already join, then send grasps?
		how do we handle entity leave from the non-owner side? because an entity that has grasps will try and move many things with it
			how do we even detect that?
		
		if it's things that are moving together maybe the events should be just one event
		"move with grabbed"
		or maybe this should be the default, since ent.move DOES move things together??
		how do I detect things that are being moved together?
			.move is recursive isn't it
			does the absgrasp know of the realgrasp?
	
	just disable grasps for now and crack on with persona-only stuff??
		"I have failed and I'll move on with simpler things"
			

handle disconnects
	if super and sublease owner missing, organize transfer
		how do you get a list of participants though? shouldn't a participant start it so they have a list, super agrees on if current owner really detected missing?
	pending events that are going to a disconnected user should "error out" to trigger a retry against the right user
		iPendingEvent.Fail -> resource.Resolve(errorevent)


gamemode: meadow: stays in game, infinite cycle, no ways to die or sleep, quits to lobby-screen
	Options:
		visibility:
			-Friends Only
			-Public
		max players:
			defaults to 32? load critical on world owner if all in world
	Rules:
		- no other mods?
		- players join a lobby
		- in the lobby, players can
			- pick which persona they'd like to go in game as
			- see unique collectables they've found in the world
			- see progression for:
				- unlocking new personas
				- unlocking new skins for each persona
				- unlocking new emotes for each persona
		- players enter the game as personas, not necessarily slugcat
		- in the game
			- players see eachothers personas
			- there are no roaming creatures
			- there are no items
			- only cosmetic placedobjects are placed
			- personas dont collide with eachother
			- the only things the player can find:
				- eachother
				- collectables the player picks up by colliding with
					- unique plants
					- unique replicas of game items
						- I'm thinking the plant-items really
				- progression bits
					???
				- puzzles
					and what I mean by this is something it takes more than 1 player to do
				- food to eat and share?
			- there is no cycle timer
			- gates have no requirements
				- or maybe... require X players, but going back is always unlocked?
					- that drop into sub though, or other one-way situations... could be bad
			- dying in a pit puts you back
				- to the room entrance?
				- to the spawn position?
			- can't run out of air when swimming
			- any other ways to die?
				- coils in 5p stun only...
				- check dnspy I guess
			- sleeping in a shelter plays a short animation
				- saves your spawn position
				- doesn't close the shelter and doesn't end the game
		
gamemode: online coop story mode : juuuust like couch coop
	needs a more fine grained description here
	essentially need to meet a set of expectations, but better have all of those written out
	- there is a host
	- there is a savestate or savefile to be used
	- players want to play together and make progress together
		- even though we could have them save position separetedly, makes more sense to keep everyone together
		- respawn in last shelter vs respawn with host (or other alive player)
		- what if the host died
	- there is a rain cycle, players must be all asleep or dead for the cycle to tick
	- engine stuff missing:
		grasps
		eating
		ai creatures doing consistent things
		cycle
		going in and out of game


Mod auto installing / auto disabling
	biggest issue: different region list
		scenario: host that has ABC, guests have AB, BC and CA, host leaves nobody can take over hosting
	oh my
	could use a whitelist maybe
	apply automatically, re-launch and re-join the lobby in question
		arg from the command line to join lobby, also needed for steam's Join feature thing
	bruteforce
	disable all other mods temporarily, store old enabledlist, relaunch with no mods



Imediate todo:
on force load, we send too much data
	done

greyed out lobby visibility is way too dark

on sleep
	what slug does it save to, make sure the game is doing the right thing

on sleep
	should wait release before enabling the start button

other player's slugs cause the game to sleep //DONE!

other loaded player dying gameovers

wakeup -> shelter close imediatelly -> starve issue

wakeup -> slow load -> sprite issue
	
sleep screen
	its picking the wrong scug

on awake
	what slug does it load

On join world, join room
if entity enter world message arrives after entity enter room message, could this cause a problem?

on join resource
	if supervisor->available message arrives late
		leasechange event is discarded
		newentity events are discarded
		need "relative to membership" signaling, OR allow queueing up while not available

refactor OnlineGameSession into OnlineGameMode for storing the game rules
	game.session is irrelevant, detect based on lobby existing
	API-ish for making custom modes?
		Prototype arena-comp, story, meadow
